<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>c&#39;t-Bot: behaviour_remotecall.c Quellcode</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">c&#39;t-Bot
   &#160;<span id="projectnumber">1898</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Erzeugt von Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Hauptseite</span></a></li>
      <li><a href="pages.html"><span>Zus√§tzliche&#160;Informationen</span></a></li>
      <li><a href="annotated.html"><span>Datenstrukturen</span></a></li>
      <li class="current"><a href="files.html"><span>Dateien</span></a></li>
      <li><a href="dirs.html"><span>Verzeichnisse</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Auflistung&#160;der&#160;Dateien</span></a></li>
      <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_14c9cc1c75a92f359ad94591d62973a1.html">bot-logic</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">behaviour_remotecall.c</div>  </div>
</div>
<div class="contents">
<a href="behaviour__remotecall_8c.html">gehe zur Dokumentation dieser Datei</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * c&#39;t-Bot</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it</span>
<a name="l00005"></a>00005 <span class="comment"> * and/or modify it under the terms of the GNU General</span>
<a name="l00006"></a>00006 <span class="comment"> * Public License as published by the Free Software</span>
<a name="l00007"></a>00007 <span class="comment"> * Foundation; either version 2 of the License, or (at your</span>
<a name="l00008"></a>00008 <span class="comment"> * option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be</span>
<a name="l00010"></a>00010 <span class="comment"> * useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<a name="l00011"></a>00011 <span class="comment"> * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<a name="l00012"></a>00012 <span class="comment"> * PURPOSE. See the GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> * You should have received a copy of the GNU General Public</span>
<a name="l00014"></a>00014 <span class="comment"> * License along with this program; if not, write to the Free</span>
<a name="l00015"></a>00015 <span class="comment"> * Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,</span>
<a name="l00016"></a>00016 <span class="comment"> * MA 02111-1307, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="bot-logic_8h.html" title="High-Level-Routinen fuer die Steuerung des c&#39;t-Bots.">bot-logic/bot-logic.h</a>&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#ifdef BEHAVIOUR_REMOTECALL_AVAILABLE</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="command_8h.html" title="Kommando-Management.">command.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="log_8h.html" title="Routinen zum Loggen von Informationen.">log.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="bot-2-bot_8h.html" title="Bot-2-Bot-Kommunikation.">bot-2-bot.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="trace_8h.html" title="Trace-Modul.">trace.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="display_8h.html" title="Routinen zur Displaysteuerung.">display.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="rc5_8h.html" title="RC5-Fernbedienung / Basic-Tasten-Handler.">rc5.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="rc5-codes_8h.html" title="RC5-Fernbedienungscodes.">rc5-codes.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="gui_8h.html" title="Display-GUI des Bots.">gui.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="behaviour__remotecall_8c.html#a7cace89e77465c16c4b1f7f75b7ae0bf">00044</a> <span class="preprocessor">#define REMOTE_CALL_IDLE 0</span>
<a name="l00045"></a><a class="code" href="behaviour__remotecall_8c.html#a9db2c8aac553c82c335ca9695550f8f6">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define REMOTE_CALL_SCHEDULED 1</span>
<a name="l00046"></a><a class="code" href="behaviour__remotecall_8c.html#adfbd6a5743f9a7497c87cd42e8ad3693">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define REMOTE_CALL_RUNNING 2</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="keyword">static</span> uint8_t running_behaviour = <a class="code" href="behaviour__remotecall_8c.html#a7cace89e77465c16c4b1f7f75b7ae0bf">REMOTE_CALL_IDLE</a>;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="keyword">static</span> uint8_t function_id = 255; 
<a name="l00052"></a>00052 <span class="keyword">static</span> uint8_t parameter_count = 0; 
<a name="l00053"></a>00053 <span class="preprocessor">#ifdef MCU</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="keyword">static</span> uint8_t parameter_data[8] = {0}; 
<a name="l00055"></a>00055 <span class="keyword">static</span> uint8_t parameter_length[<a class="code" href="behaviour__remotecall_8h.html#aa1a56135c6969dc8ca4ab0223a1c3aea" title="Maximale Anzahl an Parametern.">REMOTE_CALL_MAX_PARAM</a>] = {0}; 
<a name="l00056"></a>00056 <span class="preprocessor">#else // PC</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="keyword">static</span> uint8_t parameter_data[<a class="code" href="behaviour__remotecall_8h.html#aa1a56135c6969dc8ca4ab0223a1c3aea" title="Maximale Anzahl an Parametern.">REMOTE_CALL_MAX_PARAM</a> * <span class="keyword">sizeof</span>(<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a>)] = {0}; 
<a name="l00058"></a>00058 <span class="keyword">static</span> <span class="keyword">const</span> uint8_t * parameter_length = NULL; 
<a name="l00059"></a>00059 <span class="preprocessor">#endif // MCU</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061 <span class="preprocessor">#if REMOTE_CALL_MAX_PARAM &gt; 3</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#error &quot;Mehr als 3 Parameter werden vom Remote-Call-Code derzeit nicht unterstuetzt! Codeanpassung noetig!&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a>00065 <span class="comment">//#define DEBUG_REMOTE_CALLS /**&lt; Schalter um recht viel Debug-Code anzumachen */</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#ifndef LOG_AVAILABLE</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#undef DEBUG_REMOTE_CALLS</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00071"></a>00071 <span class="preprocessor">#ifndef DEBUG_REMOTE_CALLS</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#undef LOG_DEBUG</span>
<a name="l00073"></a><a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define LOG_DEBUG(...) {}</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076 
<a name="l00086"></a><a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787">00086</a> <span class="preprocessor">#define PREPARE_REMOTE_CALL(func, count, param, ...)  {count, {__VA_ARGS__}, #func, param, (Behaviour_t * (*) (Behaviour_t *, ...)) func}</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00114"></a><a class="code" href="behaviour__remotecall_8c.html#a6a9dc8a32e3b3827db9f446a2d4074f1">00114</a> <span class="keyword">const</span> remotecall_entry_t <a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[] <a class="code" href="behaviour__drive__chess_8c.html#a3b6187c96c81802864d44e77df6e60da">PROGMEM</a> = {
<a name="l00115"></a>00115 <span class="preprocessor">#ifdef BEHAVIOUR_PROTOTYPE_AVAILABLE</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(bot_prototype, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00117"></a>00117 <span class="comment">//  PREPARE_REMOTE_CALL(bot_prototype, 1, &quot;int16 param&quot;, 2),</span>
<a name="l00118"></a>00118 <span class="preprocessor">#endif</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>    <span class="comment">/* Demo-Verhalten fuer Einsteiger */</span>
<a name="l00120"></a>00120 <span class="preprocessor">#ifdef BEHAVIOUR_SIMPLE_AVAILABLE</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__simple_8c.html#ab54357bbed4aadb7e3e0bbce4e6e00d1">bot_simple</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00122"></a>00122     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__simple_8c.html#abcd08185c2bfd4bfbaeffec9c39ec8d8">bot_simple2</a>, 1, <span class="stringliteral">&quot;int16 light&quot;</span>, 2),
<a name="l00123"></a>00123 <span class="preprocessor">#endif</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_DRIVE_SQUARE_AVAILABLE</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__square_8c.html#a0f6346c35161a384742e3846a8b10136">bot_drive_square</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00126"></a>00126 <span class="preprocessor">#endif</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span>
<a name="l00128"></a>00128     <span class="comment">/* Hardware-Test Verhalten */</span>
<a name="l00129"></a>00129 <span class="preprocessor">#ifdef BEHAVIOUR_HW_TEST_AVAILABLE</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__hw__test_8c.html#acf48df607e34246a0ea074a44047d844" title="Veraendert den Testmode.">bot_hw_test</a>, 1, <span class="stringliteral">&quot;uint8 mode&quot;</span>, 1),
<a name="l00131"></a>00131 <span class="preprocessor">#endif</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>    <span class="comment">/* Kalibrierungs-Verhalten fuer Bot-Setup */</span>
<a name="l00133"></a>00133 <span class="preprocessor">#ifdef BEHAVIOUR_CALIBRATE_PID_AVAILABLE</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__calibrate__pid_8c.html#a14d700ae72b1c54ef8d03df19f7c0b43" title="Kalibriert die Motorregelung des ct-Bots.">bot_calibrate_pid</a>, 1, <span class="stringliteral">&quot;int16 speed&quot;</span>, 2),
<a name="l00135"></a>00135 <span class="preprocessor">#endif</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_CALIBRATE_SHARPS_AVAILABLE</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__calibrate__sharps_8c.html#a291d62b632244f477d8f995afecca17d">bot_calibrate_sharps</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00138"></a>00138 <span class="preprocessor">#endif</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a>00140     <span class="comment">/* Anwendungs-Verhalten, die komplexere Aufgaben erfuellen */</span>
<a name="l00141"></a>00141 <span class="preprocessor">#ifdef BEHAVIOUR_SOLVE_MAZE_AVAILABLE</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__solve__maze_8c.html#a4df4c969b0f99a253af4f1cc83053f59">bot_solve_maze</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00143"></a>00143 <span class="preprocessor">#endif</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_FOLLOW_LINE_AVAILABLE</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__follow__line_8h.html#a697f0c554ed200340351641b5dbb091d">bot_follow_line</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00146"></a>00146 <span class="preprocessor">#endif</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_FOLLOW_LINE_ENHANCED_AVAILABLE</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__follow__line__enhanced_8c.html#a76b3da49f97e7e6aa1245609dd560c60">bot_follow_line_enh</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00149"></a>00149 <span class="preprocessor">#endif</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_LINE_SHORTEST_WAY_AVAILABLE</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__line__shortest__way_8c.html#a0982dfc14b932f386e0a8a77c1990916">bot_line_shortest_way</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00152"></a>00152 <span class="preprocessor">#endif</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_CATCH_PILLAR_AVAILABLE</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__catch__pillar_8c.html#aadefbf6c2ed52f87907dccb9ce27c58c" title="Fange ein Objekt ein.">bot_catch_pillar</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00155"></a>00155     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__catch__pillar_8c.html#a444e8ac4ffa6c7cf3e36d72b5f95b640" title="Entlaedt das Objekt wieder.">bot_unload_pillar</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00156"></a>00156 <span class="preprocessor">#endif</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_TRANSPORT_PILLAR_AVAILABLE</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__transport__pillar_8c.html#a8ca31f021c6d27b16f573ae873c24f58">bot_transport_pillar</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00159"></a>00159 <span class="preprocessor">#endif</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_CLASSIFY_OBJECTS_AVAILABLE</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__classify__objects_8c.html#aa2b0bc4d9847ce4b7bed5ec3c352a28a">bot_classify_objects</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00162"></a>00162 <span class="preprocessor">#endif</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_FOLLOW_OBJECT_AVAILABLE</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__follow__object_8c.html#a48363707a2fbaea8c177fc6cb4f4a692" title="Botenfunktion des Objektverfolgungsverhaltens.">bot_follow_object</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00165"></a>00165 <span class="preprocessor">#endif</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_FOLLOW_WALL_AVAILABLE</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__follow__wall_8c.html#a3ff5b60cd0c490a4ff522f23a27b0628">bot_do_wall_explore</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00168"></a>00168 <span class="preprocessor">#endif</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_OLYMPIC_AVAILABLE</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__olympic_8c.html#a7ecdb9986257583f840e1ebfe289664f">bot_do_slalom</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00171"></a>00171 <span class="preprocessor">#endif</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_DRIVE_AREA_AVAILABLE</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__area_8c.html#aae766227eb7a5f661201b78d83cb57b9">bot_drive_area</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00174"></a>00174 <span class="preprocessor">#endif</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a>00176     <span class="comment">/* Fahr- und Positionierungs-Verhalten */</span>
<a name="l00177"></a>00177 <span class="preprocessor">#ifdef BEHAVIOUR_TURN_AVAILABLE</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__turn_8c.html#af8e1b5de92fa7f8f465615dff50b81fb" title="Dreht den Bot im mathematischen Drehsinn.">bot_turn</a>, 1, <span class="stringliteral">&quot;int16 degrees&quot;</span>, 2),
<a name="l00179"></a>00179     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__turn_8c.html#a7b75d957ab1dbf1a79d5403011a0b952" title="Dreht den Bot im mathematischen Drehsinn im Rahmen der angegebenen Geschwindigkeiten.">bot_turn_speed</a>, 3, <span class="stringliteral">&quot;int16 degrees, uint16 min, uint16 max&quot;</span>, 2, 2, 2),
<a name="l00180"></a>00180 <span class="preprocessor">#endif</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_GOTO_POS_AVAILABLE</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__goto__pos_8c.html#a54260069e00a15a68b8c5ffdc0cc1a6d" title="Botenfunktion des Distanz-Positionierungsverhaltens.">bot_goto_dist</a>, 2, <span class="stringliteral">&quot;int16 distance, int8 dir&quot;</span>, 2, 1),
<a name="l00183"></a>00183     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__goto__pos_8c.html#a88ddbedd618e291f1181ca34433fcd93" title="Botenfunktion des Positionierungsverhaltens.">bot_goto_pos</a>, 3, <span class="stringliteral">&quot;int16 x, int16 y, int16 head&quot;</span>, 2, 2, 2),
<a name="l00184"></a>00184     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__goto__pos_8c.html#aa2bca0e06fb57dc4352d441098940a92" title="Botenfunktion des relativen Positionierungsverhaltens.">bot_goto_pos_rel</a>, 3, <span class="stringliteral">&quot;int16 x, int16 y, int16 head&quot;</span>, 2, 2, 2),
<a name="l00185"></a>00185 <span class="preprocessor">#endif</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_GOTO_OBSTACLE_AVAILABLE</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__goto__obstacle_8c.html#abbec3c19a018455aa4e78f1af2c04ce8" title="Botenfunktion des goto_obstacle-Verhaltens.">bot_goto_obstacle</a>, 2, <span class="stringliteral">&quot;int16 distance, uint8 parallel&quot;</span>, 2, 1),
<a name="l00188"></a>00188 <span class="preprocessor">#endif</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_DRIVE_DISTANCE_AVAILABLE</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__distance_8c.html#a8d678ab6711dfaed1efa80bd2daab31c" title="Das Verhalten laesst den Bot eine vorher festgelegte Strecke fahren.">bot_drive_distance</a>, 3, <span class="stringliteral">&quot;int8 curve, int16 speed, int16 cm&quot;</span>, 1, 2, 2),
<a name="l00191"></a>00191 <span class="preprocessor">#endif</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_GOTOXY_AVAILABLE</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__gotoxy_8c.html#adcc173f93539afcc3c311b4d424cc093">bot_gotoxy</a>, 2, <span class="stringliteral">&quot;int16 x, int16 y&quot;</span>, 2, 2),
<a name="l00194"></a>00194 <span class="preprocessor">#endif</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_GOTO_AVAILABLE</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__goto_8c.html#a6301ad072bd96d055921c1bb4d7881be">bot_goto</a>, 2, <span class="stringliteral">&quot; int16 left, int16 right&quot;</span>, 2, 2),
<a name="l00197"></a>00197 <span class="preprocessor">#endif</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_PATHPLANING_AVAILABLE</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__pathplaning_8c.html#a74202693b4d8c6f79308c3c0ce708a99">bot_calc_wave</a>, 3, <span class="stringliteral">&quot;int16 dest_x, int16 dest_y, int8 compare&quot;</span>, 2, 2, 1),
<a name="l00200"></a>00200 <span class="preprocessor">#endif</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_DRIVE_STACK_AVAILABLE</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__stack_8c.html#aaea026b5beefd884c7bbd42cce8df942">bot_push_actpos</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00203"></a>00203     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__stack_8c.html#a27dc4bb2ea3f3057c5a4d5510182b5a8">bot_drive_stack</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00204"></a>00204     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__stack_8c.html#ab2ed76576e93a2a07d1373453a758b7f">bot_drive_fifo</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00205"></a>00205     <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__stack_8c.html#a48b7a3665b51ae2cbde5d9b7a97b9adb">bot_save_waypos</a>, 1, <span class="stringliteral">&quot;uint8 optimize&quot;</span>, 1),
<a name="l00206"></a>00206 <span class="preprocessor">#ifdef BOT_2_BOT_PAYLOAD_AVAILABLE</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__drive__stack_8c.html#a384bcf47313698101cf73a5f1083abc3">bot_send_stack_b2b</a>, 1, <span class="stringliteral">&quot;uint8 bot&quot;</span>, 1),
<a name="l00208"></a>00208 <span class="preprocessor">#endif</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span><span class="preprocessor">#endif // BEHAVIOUR_DRIVE_STACK_AVAILABLE</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>
<a name="l00211"></a>00211     <span class="comment">/* Servo-Steuerung */</span>
<a name="l00212"></a>00212 <span class="preprocessor">#ifdef BEHAVIOUR_SERVO_AVAILABLE</span>
<a name="l00213"></a>00213 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__servo_8c.html#ab12411c90e13fc9e924d02212a7769c6" title="Fahre den Servo an eine Position.">bot_servo</a>, 2, <span class="stringliteral">&quot;uint8 servo, uint8 pos&quot;</span>, 1, 1),
<a name="l00214"></a>00214 <span class="preprocessor">#endif</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span>
<a name="l00216"></a>00216     <span class="comment">/* Auswertungs- und Mess-Verhalten */</span>
<a name="l00217"></a>00217 <span class="preprocessor">#ifdef BEHAVIOUR_MEASURE_DISTANCE_AVAILABLE</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(bot_check_distance, 2, <span class="stringliteral">&quot;int16 max_dist, uint8 diff&quot;</span>, 2, 1),
<a name="l00219"></a>00219 <span class="preprocessor">#endif</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_SCAN_BEACONS_AVAILABLE</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__scan__beacons_8c.html#a5a3cdbacd1818b665d46ad7c502ecfad">bot_scan_beacons</a>, 2, <span class="stringliteral">&quot;uint8 pos_upd, uint8 mode&quot;</span>, 1, 1),
<a name="l00222"></a>00222 <span class="preprocessor">#endif</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_GET_UTILIZATION_AVAILABLE</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__get__utilization_8c.html#a2e68dde929973f9d14cbbb37e5051b6b">bot_get_utilization</a>, 1, <span class="stringliteral">&quot;uint8 beh&quot;</span>, 1),
<a name="l00225"></a>00225 <span class="preprocessor">#endif</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span>
<a name="l00227"></a>00227     <span class="comment">/* Test-Verhalten */</span>
<a name="l00228"></a>00228 <span class="preprocessor">#ifdef BEHAVIOUR_TURN_TEST_AVAILABLE</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__turn__test_8c.html#a1a800fa5d43fe5b8a1b958b329e4f70b">bot_turn_test</a>, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00230"></a>00230 <span class="preprocessor">#endif</span>
<a name="l00231"></a>00231 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_TEST_ENCODER_AVAILABLE</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(bot_test_encoder, 0, <span class="stringliteral">&quot;&quot;</span>, 0),
<a name="l00233"></a>00233 <span class="preprocessor">#endif</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span><span class="preprocessor">#ifdef BOT_2_BOT_PAYLOAD_TEST_AVAILABLE</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="bot-2-bot_8c.html#a7238aec612fed1eff070a8b59d8b75ab">bot_2_bot_pl_test</a>, 1, <span class="stringliteral">&quot;uint8 to&quot;</span>, 1),
<a name="l00236"></a>00236 <span class="preprocessor">#endif</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a>00238 <span class="preprocessor">#ifdef BEHAVIOUR_ABL_AVAILABLE</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#aa59a811d20a83281cd724c35a064d787" title="Dieses Makro bereitet eine Botenfunktion als Remote-Call-Funktion vor.">PREPARE_REMOTE_CALL</a>(<a class="code" href="behaviour__abl_8c.html#afd04cd8c063febbdbdaf747ce5b07e7c" title="Syntax-Check des aktuellen ABL-Programms per RemoteCall.">bot_abl_check</a>, 1, <span class="stringliteral">&quot;uint16 line&quot;</span>, 2),
<a name="l00240"></a>00240 <span class="preprocessor">#endif</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>    {0, {0}, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, NULL}
<a name="l00242"></a>00242 };
<a name="l00243"></a>00243 
<a name="l00245"></a><a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0">00245</a> <span class="preprocessor">#define STORED_CALLS (sizeof(remotecall_beh_list) / sizeof(remotecall_entry_t))</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>
<a name="l00252"></a><a class="code" href="behaviour__remotecall_8h.html#a21a28f702e176f3d2bc47fd5eda02f55">00252</a> uint8_t <a class="code" href="behaviour__remotecall_8c.html#a21a28f702e176f3d2bc47fd5eda02f55" title="Sucht den Index des Remote-Calls heraus.">get_remotecall_id</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * call) {
<a name="l00253"></a>00253     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;Suche nach Funktion: \&quot;%s\&quot;&quot;</span>, call);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     uint8_t <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00256"></a>00256     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a>; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (!strcmp_P (call, <a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[i].name)) {
<a name="l00258"></a>00258             <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;calls[%u].name=\&quot;%s\&quot; passt&quot;</span>, i, call);
<a name="l00259"></a>00259             <span class="keywordflow">return</span> <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262     <span class="keywordflow">return</span> 255;
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00273"></a>00273 <span class="keyword">static</span> <span class="keywordtype">void</span> remotecall_convert_params(uint8_t * dest, <span class="keyword">const</span> uint8_t count, <span class="keyword">const</span> uint8_t * len, <span class="keyword">const</span> <span class="keywordtype">void</span> * data) {
<a name="l00274"></a>00274     <span class="keyword">const</span> uint8_t * ptr = data;
<a name="l00275"></a>00275     (void) ptr;
<a name="l00276"></a>00276     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;p_data=%x %x %x %x&quot;</span>, ptr[0], ptr[1], ptr[2], ptr[3]);
<a name="l00277"></a>00277     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;%x %x %x %x&quot;</span>, ptr[4], ptr[5], ptr[6], ptr[7]);
<a name="l00278"></a>00278     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;%x %x %x %x&quot;</span>, ptr[8], ptr[9], ptr[10], ptr[11]);
<a name="l00279"></a>00279 <span class="preprocessor">#ifdef MCU</span>
<a name="l00280"></a>00280 <span class="preprocessor"></span>    dest += 8; <span class="comment">// ans Ende springen</span>
<a name="l00281"></a>00281     uint8_t <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00282"></a>00282     <span class="comment">/* Parameter rueckwaerts einlesen */</span>
<a name="l00283"></a>00283     <span class="keywordflow">for</span> (i = 0; i &lt; count; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00284"></a>00284         uint8_t pos = (uint8_t) (len[i] &gt; 1 ? len[i] : 2); <span class="comment">// alle Parameter sind 16-Bit-aligned</span>
<a name="l00285"></a>00285         dest -= pos;
<a name="l00286"></a>00286         memcpy(dest, ptr, len[i]);
<a name="l00287"></a>00287         ptr += <span class="keyword">sizeof</span>(<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a>);
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 <span class="preprocessor">#else // PC</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>    (void) len;
<a name="l00291"></a>00291 <span class="preprocessor">#if BYTE_ORDER == LITTLE_ENDIAN</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>    <span class="comment">/* Daten einfach kopieren */</span>
<a name="l00293"></a>00293     memcpy(dest, data, count * <span class="keyword">sizeof</span>(<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a>));
<a name="l00294"></a>00294 <span class="preprocessor">#else // BIG_EDIAN</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span>    uint8_t <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00296"></a>00296     <span class="keywordflow">for</span> (i = 0; i &lt; count; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00297"></a>00297         <span class="comment">/* Parameter i von little-endian nach big-endian konvertieren*/</span>
<a name="l00298"></a>00298         <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> in, out;
<a name="l00299"></a>00299         in = *((<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> *) data);
<a name="l00300"></a>00300         out.<a class="code" href="unionremote__call__data__t.html#a0366901b0aa01efdb0092c161f0560fe" title="32 Bit unsigned integer">u32</a> = ((in.<a class="code" href="unionremote__call__data__t.html#a0366901b0aa01efdb0092c161f0560fe" title="32 Bit unsigned integer">u32</a> &amp; 0xff) &lt;&lt; 24) | ((in.<a class="code" href="unionremote__call__data__t.html#a0366901b0aa01efdb0092c161f0560fe" title="32 Bit unsigned integer">u32</a> &amp; 0xff00) &lt;&lt; 8) | ((in.<a class="code" href="unionremote__call__data__t.html#a0366901b0aa01efdb0092c161f0560fe" title="32 Bit unsigned integer">u32</a> &amp; 0xff0000) &gt;&gt; 8) | ((in.<a class="code" href="unionremote__call__data__t.html#a0366901b0aa01efdb0092c161f0560fe" title="32 Bit unsigned integer">u32</a> &amp; 0xff000000) &gt;&gt; 24);
<a name="l00301"></a>00301         memcpy(dest, &amp;out, <span class="keyword">sizeof</span>(<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a>));
<a name="l00302"></a>00302         dest += <span class="keyword">sizeof</span>(<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a>);
<a name="l00303"></a>00303         data += <span class="keyword">sizeof</span>(<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a>);
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305 <span class="preprocessor">#endif // LITTLE_EDIAN</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span>
<a name="l00307"></a>00307 <span class="preprocessor">#endif // MCU</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>}
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 <span class="preprocessor">#ifdef PC</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="behaviour__remotecall_8c.html#a2b049dee846b1e153ad54fdadb62175a" title="Dummy-Funktion, die nur dafuer sorgt, dass die Parameterdaten auch in den Floating-Point Registern st...">bot_remotecall_fl_dummy</a>(<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * caller, ...) <a class="code" href="init_8h.html#a87df7e6560f87322f737157d976f8e6f" title="Kopie des MCU(C)SR Registers.">__attribute__</a>((noinline));
<a name="l00312"></a>00312 
<a name="l00317"></a><a class="code" href="behaviour__remotecall_8c.html#a2b049dee846b1e153ad54fdadb62175a">00317</a> <span class="keywordtype">void</span> <a class="code" href="behaviour__remotecall_8c.html#a2b049dee846b1e153ad54fdadb62175a" title="Dummy-Funktion, die nur dafuer sorgt, dass die Parameterdaten auch in den Floating-Point Registern st...">bot_remotecall_fl_dummy</a>(<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * caller, ...) {
<a name="l00318"></a>00318     (void) caller; <span class="comment">// kein warning</span>
<a name="l00319"></a>00319     __asm__ __volatile__(<span class="stringliteral">&quot;nop&quot;</span>);
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 <span class="preprocessor">#endif // PC</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>
<a name="l00328"></a><a class="code" href="behaviour__remotecall_8h.html#a471b777ece29bb0d0149ef4ac6241945">00328</a> <span class="keywordtype">void</span> <a class="code" href="behaviour__remotecall_8c.html#a471b777ece29bb0d0149ef4ac6241945" title="Dieses Verhalten kuemmert sich darum die Verhalten, die von aussen angefragt wurden zu starten und li...">bot_remotecall_behaviour</a>(<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * data) {
<a name="l00329"></a>00329     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;Enter bot_remotecall_behaviour&quot;</span>);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keywordflow">switch</span> (running_behaviour) {
<a name="l00332"></a>00332         <span class="keywordflow">case</span> <a class="code" href="behaviour__remotecall_8c.html#a9db2c8aac553c82c335ca9695550f8f6">REMOTE_CALL_SCHEDULED</a>: <span class="comment">// Es laueft kein Auftrag, aber es steht ein Neuer an</span>
<a name="l00333"></a>00333             <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;REMOTE_CALL_SCHEDULED&quot;</span>);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335             <span class="keywordflow">if</span> (function_id &gt;= <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a>) {
<a name="l00336"></a>00336                 <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;keine Funktion gefunden. Exit&quot;</span>);
<a name="l00337"></a>00337                 running_behaviour = <a class="code" href="behaviour__remotecall_8c.html#a7cace89e77465c16c4b1f7f75b7ae0bf">REMOTE_CALL_IDLE</a>;
<a name="l00338"></a>00338                 <a class="code" href="bot-logic_8c.html#ae957e610d7a3b2034084f87277a319de" title="Kehrt zum aufrufenden Verhalten zurueck und setzt den Status auf Erfolg oder Misserfolg.">exit_behaviour</a>(data, <a class="code" href="bot-logic_8h.html#a78d9ef1511522ee147d2d386a584a5d7" title="Konstante fuer Behaviour_t-&gt;subResult: Aufgabe nicht abgeschlossen.">BEHAVIOUR_SUBFAIL</a>);
<a name="l00339"></a>00339                 <span class="keywordflow">return</span>;
<a name="l00340"></a>00340             }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 <span class="preprocessor">#ifdef PC</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>            void (* func) (<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * data, ...);
<a name="l00344"></a>00344             <span class="comment">// Auf dem PC liegt die remotecall_beh_list-Struktur im RAM</span>
<a name="l00345"></a>00345             func = (void (*) (<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> *, ...)) <a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[function_id].func;
<a name="l00346"></a>00346 <span class="preprocessor">#else // MCU</span>
<a name="l00347"></a>00347 <span class="preprocessor"></span>            void (* func) (<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * data, <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> dword1, <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> dword2);
<a name="l00348"></a>00348             <span class="comment">// Auf dem MCU liegt die remotecall_beh_list-Struktur im Flash und muss erst geholt werden</span>
<a name="l00349"></a>00349             func = (void (*) (<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> *, <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a>, remote_call_data_t))
<a name="l00350"></a>00350                 pgm_read_word(&amp;<a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[function_id].func);
<a name="l00351"></a>00351 <span class="preprocessor">#endif // PC</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span>
<a name="l00353"></a>00353             <span class="keywordflow">if</span> (parameter_count &gt; <a class="code" href="behaviour__remotecall_8h.html#aa1a56135c6969dc8ca4ab0223a1c3aea" title="Maximale Anzahl an Parametern.">REMOTE_CALL_MAX_PARAM</a>) {
<a name="l00354"></a>00354                 <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;Parameteranzahl unzulaessig!&quot;</span>);
<a name="l00355"></a>00355                 running_behaviour = <a class="code" href="behaviour__remotecall_8c.html#a7cace89e77465c16c4b1f7f75b7ae0bf">REMOTE_CALL_IDLE</a>;
<a name="l00356"></a>00356                 <span class="keywordflow">return</span>;
<a name="l00357"></a>00357             }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359             <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;function_id=%u&quot;</span>, function_id);
<a name="l00360"></a>00360             <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;parameter_count=%u&quot;</span>, parameter_count);
<a name="l00361"></a>00361             remote_call_data_t * parameter = (remote_call_data_t *) parameter_data;
<a name="l00362"></a>00362 <span class="preprocessor">#ifdef PC</span>
<a name="l00363"></a>00363 <span class="preprocessor"></span>            <a class="code" href="behaviour__remotecall_8c.html#a2b049dee846b1e153ad54fdadb62175a" title="Dummy-Funktion, die nur dafuer sorgt, dass die Parameterdaten auch in den Floating-Point Registern st...">bot_remotecall_fl_dummy</a>(data, parameter[0].fl32, parameter[1].fl32, parameter[2].fl32);
<a name="l00364"></a>00364             func(data, parameter[0], parameter[1], parameter[2]);
<a name="l00365"></a>00365 <span class="preprocessor">#else // MCU</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span>            func(data, parameter[1], parameter[0]); <span class="comment">// &quot;rueckwaerts&quot;, denn kleinere Parameter-Nr liegen an hoereren Register-Nr.!</span>
<a name="l00367"></a>00367 <span class="preprocessor">#endif // PC</span>
<a name="l00368"></a>00368 <span class="preprocessor"></span>            running_behaviour = <a class="code" href="behaviour__remotecall_8c.html#adfbd6a5743f9a7497c87cd42e8ad3693">REMOTE_CALL_RUNNING</a>;
<a name="l00369"></a>00369             <span class="keywordflow">break</span>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         <span class="keywordflow">case</span> <a class="code" href="behaviour__remotecall_8c.html#adfbd6a5743f9a7497c87cd42e8ad3693">REMOTE_CALL_RUNNING</a>: <span class="comment">// Es lief ein Verhalten und ist nun zuende (sonst waeren wir nicht hier)</span>
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373             <span class="comment">/* Antwort schicken */</span>
<a name="l00374"></a>00374             <span class="keywordtype">char</span> * function_name;
<a name="l00375"></a>00375             <span class="comment">// Auf dem MCU muessen wir die Daten erstmal aus dem Flash holen</span>
<a name="l00376"></a>00376             <span class="keywordtype">char</span> tmp[<a class="code" href="behaviour__remotecall_8h.html#ad306d73a9a1622db3a77a67a6f431c62" title="Laenge der Funktionsnamen.">REMOTE_CALL_FUNCTION_NAME_LEN</a> + 1];
<a name="l00377"></a>00377             memcpy_P(tmp, &amp;<a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[function_id].name, <a class="code" href="behaviour__remotecall_8h.html#ad306d73a9a1622db3a77a67a6f431c62" title="Laenge der Funktionsnamen.">REMOTE_CALL_FUNCTION_NAME_LEN</a> + 1);
<a name="l00378"></a>00378             function_name = (<span class="keywordtype">char</span> *) &amp;tmp;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380             int16_t result = data-&gt;<a class="code" href="struct__Behaviour__t.html#ac854c181b7e05da0fdc40a5c70547054" title="War das aufgerufene Unterverhalten erfolgreich (==1)?">subResult</a>;
<a name="l00381"></a>00381             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="struct__Behaviour__t.html#ac13150f4159865130a32bdee24dea847" title="aufrufendes Verhalten">caller</a>) {
<a name="l00382"></a>00382 <span class="preprocessor">#ifdef BEHAVIOUR_ABL_AVAILABLE</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span>                abl_push_value((uint16_t) result);
<a name="l00384"></a>00384 <span class="preprocessor">#endif</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span><span class="preprocessor">#ifdef BEHAVIOUR_UBASIC_AVAILABLE</span>
<a name="l00386"></a>00386 <span class="preprocessor"></span>                <a class="code" href="behaviour__ubasic_8c.html#a2848cba9266f6cab9859fad47aecfb83">ubasic_push_value</a>((uint16_t) result);
<a name="l00387"></a>00387 <span class="preprocessor">#endif</span>
<a name="l00388"></a>00388 <span class="preprocessor"></span>            }
<a name="l00389"></a>00389 <span class="preprocessor">#ifdef COMMAND_AVAILABLE</span>
<a name="l00390"></a>00390 <span class="preprocessor"></span>            <span class="keywordflow">else</span> {
<a name="l00391"></a>00391                 <span class="comment">/* kein Caller, also kam der Aufruf wohl vom Sim */</span>
<a name="l00392"></a>00392                 <a class="code" href="command_8c.html#aef266284aebb772b9592228ed9019469">command_write_data</a>(<a class="code" href="command_8h.html#a460fb171ceff9367797f3b663882352b">CMD_REMOTE_CALL</a>, <a class="code" href="command_8h.html#afe3055cdf5b1187f6a25e1e96708b0f5">SUB_REMOTE_CALL_DONE</a>, result, result, function_name);
<a name="l00393"></a>00393             }
<a name="l00394"></a>00394 <span class="preprocessor">#endif // COMMAND_AVAILABLE</span>
<a name="l00395"></a>00395 <span class="preprocessor"></span>            <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;RemoteCall %s beendet (%u)&quot;</span>, function_name, result);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397             <span class="comment">// Aufrauemen</span>
<a name="l00398"></a>00398             function_id = 255;
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400         <span class="comment">/* no break */</span>
<a name="l00401"></a>00401         <span class="keywordflow">default</span>:
<a name="l00402"></a>00402             running_behaviour = <a class="code" href="behaviour__remotecall_8c.html#a7cace89e77465c16c4b1f7f75b7ae0bf">REMOTE_CALL_IDLE</a>;
<a name="l00403"></a>00403             return_from_behaviour(data); <span class="comment">// und Verhalten auch aus</span>
<a name="l00404"></a>00404             <span class="keywordflow">break</span>;
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00415"></a>00415 <span class="keyword">static</span> int8_t bot_remotecall_from_id(<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * caller, <span class="keyword">const</span> uint8_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> * data) {
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (running_behaviour != <a class="code" href="behaviour__remotecall_8c.html#a7cace89e77465c16c4b1f7f75b7ae0bf">REMOTE_CALL_IDLE</a>) {
<a name="l00417"></a>00417         <span class="comment">/* Verhalten noch aktiv, Abbruch */</span>
<a name="l00418"></a>00418         <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;Bereits ein RemoteCall aktiv (ID=%u)!&quot;</span>, function_id);
<a name="l00419"></a>00419         <span class="keywordflow">return</span> -1;
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt;= <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 1) {
<a name="l00423"></a>00423         <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;Funktion mit ID=%u nicht vorhanden.&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00424"></a>00424         <span class="keywordflow">return</span> -2;
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <a class="code" href="bot-logic_8c.html#a123152ecfcd89545c2603cb3f2e873c9" title="Ruft ein anderes Verhalten auf und merkt sich den Ruecksprung return_from_behaviour() kehrt dann spae...">switch_to_behaviour</a>(caller, <a class="code" href="behaviour__remotecall_8c.html#a471b777ece29bb0d0149ef4ac6241945" title="Dieses Verhalten kuemmert sich darum die Verhalten, die von aussen angefragt wurden zu starten und li...">bot_remotecall_behaviour</a>, <a class="code" href="bot-logic_8h.html#a59191cd512c3376a23c8a7d259a1e111" title="Konstanten, wenn Verhalten beim Aufruf alte Wuensche nicht ueberschreiben sollen.">BEHAVIOUR_NOOVERRIDE</a>);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     function_id = <a class="code" href="behaviour__scan__beacons_8c.html#a4fc3a0c58dfbd1e68224521185cb9384">id</a>;
<a name="l00430"></a>00430     parameter_count = pgm_read_byte(&amp;remotecall_beh_list[function_id].param_count);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="comment">// parameter_length: Zeiger auf ein Array, das zuerst die Anzahl der Parameter und danach die Anzahl der Bytes fuer die jeweiligen Parameter enthaelt</span>
<a name="l00433"></a>00433 <span class="preprocessor">#ifdef PC</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span>    parameter_length = <a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[function_id].param_len;
<a name="l00435"></a>00435 <span class="preprocessor">#else</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span>    <span class="comment">// Auf dem MCU muessen wir die Daten erstmal aus dem Flash holen</span>
<a name="l00437"></a>00437     memcpy_P(parameter_length, &amp;remotecall_beh_list[function_id].param_len, parameter_count);
<a name="l00438"></a>00438 <span class="preprocessor">#endif // PC</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span>
<a name="l00440"></a>00440     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;func=%u param_count=%u Len= %u %u %u&quot;</span>, remotecall_beh_list[function_id].name, parameter_count, parameter_length[0], parameter_length[1],
<a name="l00441"></a>00441         parameter_length[2]);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     remotecall_convert_params(parameter_data, parameter_count, parameter_length, data);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;p_data=%x %x %x %x&quot;</span>, parameter_data[0], parameter_data[1], parameter_data[2], parameter_data[3]);
<a name="l00446"></a>00446     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;%x %x %x %x&quot;</span>, parameter_data[4], parameter_data[5], parameter_data[6], parameter_data[7]);
<a name="l00447"></a>00447 <span class="preprocessor">#ifdef PC</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>    <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;%x %x %x %x&quot;</span>, parameter_data[8], parameter_data[9], parameter_data[10], parameter_data[11]);
<a name="l00449"></a>00449 <span class="preprocessor">#endif</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>
<a name="l00451"></a>00451     running_behaviour = <a class="code" href="behaviour__remotecall_8c.html#a9db2c8aac553c82c335ca9695550f8f6">REMOTE_CALL_SCHEDULED</a>;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="preprocessor">#ifdef CREATE_TRACEFILE_AVAILABLE</span>
<a name="l00454"></a>00454 <span class="preprocessor"></span>    <a class="code" href="trace_8h.html#a2da9842c109a1d71909da03036199c6a" title="Fueht dem Trace-Puffer einen RemoteCall-Aufruf hinzu.">trace_add_remotecall</a>(remotecall_beh_list[function_id].name, parameter_count, (<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> *) parameter_data);
<a name="l00455"></a>00455 <span class="preprocessor">#endif // CREATE_TRACEFILE_AVAILABLE</span>
<a name="l00456"></a>00456 <span class="preprocessor"></span>
<a name="l00457"></a>00457     <span class="keywordflow">return</span> 0;
<a name="l00458"></a>00458 }
<a name="l00459"></a>00459 
<a name="l00467"></a><a class="code" href="behaviour__remotecall_8h.html#ac29918eefe5051bf14524c1d41a4be2a">00467</a> int8_t <a class="code" href="behaviour__remotecall_8c.html#ac29918eefe5051bf14524c1d41a4be2a" title="Fuehrt einen RemoteCall aus.">bot_remotecall</a>(<a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * caller, <span class="keyword">const</span> <span class="keywordtype">char</span> * func, <span class="keyword">const</span> <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> * data) {
<a name="l00468"></a>00468     <span class="keyword">const</span> uint8_t <span class="keywordtype">id</span> = <a class="code" href="behaviour__remotecall_8c.html#a21a28f702e176f3d2bc47fd5eda02f55" title="Sucht den Index des Remote-Calls heraus.">get_remotecall_id</a>(func);
<a name="l00469"></a>00469     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt;= <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 1) {
<a name="l00470"></a>00470         <a class="code" href="log_8h.html#af3fb0ee7384d6813437103a2c2646fb7">LOG_ERROR</a>(<span class="stringliteral">&quot;Verhalten \&quot;%s\&quot; nicht gefunden.&quot;</span>, func);
<a name="l00471"></a>00471     }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="keywordflow">return</span> bot_remotecall_from_id(caller, <span class="keywordtype">id</span>, data);
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 
<a name="l00481"></a><a class="code" href="behaviour__remotecall_8h.html#a2d4d5ffc85a46ea33524f7afc2ff01fb">00481</a> <span class="keywordtype">void</span> <a class="code" href="behaviour__remotecall_8c.html#a2d4d5ffc85a46ea33524f7afc2ff01fb" title="Fuehrt einen RemoteCall aus.">bot_remotecall_from_command</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * data) {
<a name="l00482"></a>00482     <span class="keyword">const</span> <span class="keywordtype">char</span> * function_name = data;
<a name="l00483"></a>00483     <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> * params = (<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> *) (data + strlen(function_name) + 1);
<a name="l00484"></a>00484     <a class="code" href="behaviour__remotecall_8c.html#ac29918eefe5051bf14524c1d41a4be2a" title="Fuehrt einen RemoteCall aus.">bot_remotecall</a>(NULL, function_name, params);
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00490"></a><a class="code" href="behaviour__remotecall_8h.html#abffe83c4d73ee63ce716fa22b67d0d3b">00490</a> <span class="keywordtype">void</span> <a class="code" href="behaviour__remotecall_8c.html#abffe83c4d73ee63ce716fa22b67d0d3b" title="Bricht einen laufenden RemoteCall ab.">bot_remotecall_cancel</a>(<span class="keywordtype">void</span>) {
<a name="l00491"></a>00491     <a class="code" href="struct__Behaviour__t.html" title="Verwaltungsstruktur fuer die Verhaltensroutinen.">Behaviour_t</a> * <span class="keyword">const</span> <a class="code" href="behaviour__cancel__behaviour_8c.html#a14c3dff38972ba103adb11d085586597" title="Zeiger auf Verhaltensdatensatz des zu ueberwachenden Verhaltens.">beh</a> = <a class="code" href="bot-logic_8c.html#a11e7a95fd56f9703bd2bd9c61300df6c" title="Liefert das Verhalten zurueck, welches durch function implementiert ist.">get_behaviour</a>(<a class="code" href="behaviour__remotecall_8c.html#a471b777ece29bb0d0149ef4ac6241945" title="Dieses Verhalten kuemmert sich darum die Verhalten, die von aussen angefragt wurden zu starten und li...">bot_remotecall_behaviour</a>);
<a name="l00492"></a>00492     <span class="comment">/* gestartete Verhalten abbrechen */</span>
<a name="l00493"></a>00493     <a class="code" href="bot-logic_8c.html#a7f318ddb329eb66eb8ac6053e65b415f" title="Deaktiviert alle von diesem Verhalten aufgerufenen Verhalten.">deactivate_called_behaviours</a>(beh);
<a name="l00494"></a>00494     <span class="comment">/* RemoteCall-Verhalten korrekt beenden, um Antwort zu senden */</span>
<a name="l00495"></a>00495     <a class="code" href="behaviour__remotecall_8c.html#a471b777ece29bb0d0149ef4ac6241945" title="Dieses Verhalten kuemmert sich darum die Verhalten, die von aussen angefragt wurden zu starten und li...">bot_remotecall_behaviour</a>(beh);
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00501"></a><a class="code" href="behaviour__remotecall_8h.html#a6e58a88e7c3aaf40d4f78c9f5c14653b">00501</a> <span class="keywordtype">void</span> <a class="code" href="behaviour__remotecall_8c.html#a6e58a88e7c3aaf40d4f78c9f5c14653b" title="Listet alle verfuegbaren Remote-Calls auf und verschickt sie als einzelne Kommandos.">bot_remotecall_list</a>(<span class="keywordtype">void</span>) {
<a name="l00502"></a>00502 <span class="preprocessor">#ifdef MCU</span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>    remotecall_entry_t call_storage;
<a name="l00504"></a>00504 <span class="preprocessor">#endif</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span>    <span class="keyword">const</span> remotecall_entry_t * call;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;Liste %u RemoteCalls&quot;</span>, <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a>);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     uint16_t <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00510"></a>00510     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a>; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00511"></a>00511 <span class="preprocessor">#ifdef MCU</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span>        <span class="comment">// Auf dem MCU muessen die Daten erstmal aus dem Flash ins RAM</span>
<a name="l00513"></a>00513         memcpy_P(&amp;call_storage, &amp;<a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[i], <span class="keyword">sizeof</span>(remotecall_entry_t));
<a name="l00514"></a>00514         call = &amp;call_storage;
<a name="l00515"></a>00515 <span class="preprocessor">#else</span>
<a name="l00516"></a>00516 <span class="preprocessor"></span>        call = &amp;<a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>];
<a name="l00517"></a>00517 <span class="preprocessor">#endif // MCU</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>
<a name="l00519"></a>00519 <span class="preprocessor">#ifdef COMMAND_AVAILABLE</span>
<a name="l00520"></a>00520 <span class="preprocessor"></span>        <span class="comment">// und uebertragen</span>
<a name="l00521"></a>00521         <a class="code" href="command_8c.html#a1497433f9f7384b363203b7bfd3bfe28">command_write_rawdata</a>(<a class="code" href="command_8h.html#a460fb171ceff9367797f3b663882352b">CMD_REMOTE_CALL</a>, <a class="code" href="command_8h.html#a04b9a1b8c1ca4b60752101a8248f0e7b">SUB_REMOTE_CALL_ENTRY</a>, (int16_t) i, (int16_t) i, <span class="keyword">sizeof</span>(remotecall_entry_t), call);
<a name="l00522"></a>00522 <span class="preprocessor">#endif</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span>        <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;%s(%s)&quot;</span>, call-&gt;name, call-&gt;param_info);
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <span class="preprocessor">#if defined DISPLAY_REMOTECALL_AVAILABLE &amp;&amp; defined KEYPAD_AVAILABLE</span>
<a name="l00528"></a>00528 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> keypad_params[<a class="code" href="behaviour__remotecall_8h.html#aa1a56135c6969dc8ca4ab0223a1c3aea" title="Maximale Anzahl an Parametern.">REMOTE_CALL_MAX_PARAM</a>]; 
<a name="l00529"></a>00529 <span class="keyword">static</span> uint8_t keypad_param_index= 0; 
<a name="l00530"></a>00530 <span class="keyword">static</span> uint8_t beh_selected = 0; 
<a name="l00536"></a>00536 <span class="keyword">static</span> <span class="keywordtype">void</span> keypad_param(<span class="keywordtype">char</span> * data) {
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (keypad_param_index &lt; <a class="code" href="behaviour__remotecall_8h.html#aa1a56135c6969dc8ca4ab0223a1c3aea" title="Maximale Anzahl an Parametern.">REMOTE_CALL_MAX_PARAM</a> &amp;&amp; *data != 0) {
<a name="l00538"></a>00538         keypad_params[keypad_param_index].<a class="code" href="unionremote__call__data__t.html#a148b79413df7654a5211bf5e583c0220" title="16 Bit signed integer">s16</a> = atoi(data);
<a name="l00539"></a>00539         ++keypad_param_index;
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541     beh_selected = 1;
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00556"></a><a class="code" href="behaviour__remotecall_8h.html#a87897b1c6fabd2a2eed86be52afa8948">00556</a> <span class="keywordtype">void</span> <a class="code" href="behaviour__remotecall_8c.html#a87897b1c6fabd2a2eed86be52afa8948" title="Displayhandler fuer RemoteCall-Display.">remotecall_display</a>(<span class="keywordtype">void</span>) {
<a name="l00557"></a>00557     <span class="keyword">static</span> uint8_t first_row = 0; <span class="comment">// erste Verhaltens-ID, die auf dem Display angezeigt wird</span>
<a name="l00558"></a>00558     <span class="keyword">static</span> int8_t selected_row = 0; <span class="comment">// Offset der markierten Zeile (relativ zu first_row)</span>
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <span class="comment">/* Keyhandler */</span>
<a name="l00561"></a>00561     <span class="keywordflow">switch</span> (<a class="code" href="sensor_8h.html#a0c6d9b2de12c900271241f3044baaa92">RC5_Code</a>) {
<a name="l00562"></a>00562     <span class="keywordflow">case</span> <a class="code" href="rc5-codes_8h.html#a116fd307dd0b2e76d0317f3b56e2b847">RC5_CODE_UP</a>: <span class="comment">// zurueck blaettern</span>
<a name="l00563"></a>00563         --selected_row;
<a name="l00564"></a>00564         keypad_param_index = 0;
<a name="l00565"></a>00565         beh_selected = 0;
<a name="l00566"></a>00566         <a class="code" href="sensor_8h.html#a0c6d9b2de12c900271241f3044baaa92">RC5_Code</a> = 0;
<a name="l00567"></a>00567         <span class="keywordflow">break</span>;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <span class="keywordflow">case</span> <a class="code" href="rc5-codes_8h.html#aab2ee4ada2c31be590df5de709980f65">RC5_CODE_DOWN</a>: <span class="comment">// vor blaettern oder laufenden RC abbrechen</span>
<a name="l00570"></a>00570         <span class="keywordflow">if</span> (running_behaviour == <a class="code" href="behaviour__remotecall_8c.html#adfbd6a5743f9a7497c87cd42e8ad3693">REMOTE_CALL_RUNNING</a>) {
<a name="l00571"></a>00571             <a class="code" href="behaviour__remotecall_8c.html#abffe83c4d73ee63ce716fa22b67d0d3b" title="Bricht einen laufenden RemoteCall ab.">bot_remotecall_cancel</a>();
<a name="l00572"></a>00572         } <span class="keywordflow">else</span> {
<a name="l00573"></a>00573             ++selected_row;
<a name="l00574"></a>00574             keypad_param_index = 0;
<a name="l00575"></a>00575             beh_selected = 0;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577         <a class="code" href="sensor_8h.html#a0c6d9b2de12c900271241f3044baaa92">RC5_Code</a> = 0;
<a name="l00578"></a>00578         <span class="keywordflow">break</span>;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     <span class="keywordflow">case</span> <a class="code" href="rc5-codes_8h.html#a54a6edce9c1e27220d33990b3078c08c">RC5_CODE_PLAY</a>: <span class="comment">// auswahlen / starten</span>
<a name="l00581"></a>00581         beh_selected = 1;
<a name="l00582"></a>00582         first_row = (uint8_t) (first_row + selected_row);
<a name="l00583"></a>00583         <span class="keywordflow">if</span> (first_row &gt; <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 2) {
<a name="l00584"></a>00584             first_row = (uint8_t) (first_row - (<a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 1));
<a name="l00585"></a>00585         }
<a name="l00586"></a>00586         selected_row = 0;
<a name="l00587"></a>00587         <a class="code" href="sensor_8h.html#a0c6d9b2de12c900271241f3044baaa92">RC5_Code</a> = 0;
<a name="l00588"></a>00588         <span class="keywordflow">break</span>;
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="comment">/* Anzeige */</span>
<a name="l00592"></a>00592     <a class="code" href="display_8h.html#a336e8b1e4fcf1785ec84e0eed492c418" title="Loescht das ganze Display.">display_clear</a>();
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (selected_row &gt; 2) {
<a name="l00594"></a>00594         selected_row = 2;
<a name="l00595"></a>00595         ++first_row;
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (first_row &gt; <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 2) {
<a name="l00597"></a>00597             first_row = 0;
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (selected_row &lt; 0) {
<a name="l00600"></a>00600         selected_row = 0;
<a name="l00601"></a>00601         --first_row;
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (first_row &gt; <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 2) {
<a name="l00603"></a>00603             first_row = <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 2;
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     uint8_t row;
<a name="l00608"></a>00608     <span class="keyword">const</span> remotecall_entry_t * ptr_call;
<a name="l00609"></a>00609     <span class="keyword">const</span> uint8_t <a class="code" href="behaviour__drive__chess_8c.html#aa94ff7ddd304b9beb2f209b6174e180e">n</a> = (uint8_t) (beh_selected &gt; 0 || running_behaviour == <a class="code" href="behaviour__remotecall_8c.html#adfbd6a5743f9a7497c87cd42e8ad3693">REMOTE_CALL_RUNNING</a> ? 1 : 3);
<a name="l00610"></a>00610     uint8_t <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00611"></a>00611     <span class="keywordflow">for</span> (i = 1; i &lt;= <a class="code" href="behaviour__drive__chess_8c.html#aa94ff7ddd304b9beb2f209b6174e180e">n</a>; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00612"></a>00612         <span class="keywordflow">if</span> (running_behaviour == <a class="code" href="behaviour__remotecall_8c.html#adfbd6a5743f9a7497c87cd42e8ad3693">REMOTE_CALL_RUNNING</a>) {
<a name="l00613"></a>00613             row = function_id;
<a name="l00614"></a>00614         } <span class="keywordflow">else</span> {
<a name="l00615"></a>00615             row = (uint8_t) (first_row + (i - 1));
<a name="l00616"></a>00616             <span class="keywordflow">if</span> (row &gt; <a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 2) {
<a name="l00617"></a>00617                 row = (uint8_t) (row - (<a class="code" href="behaviour__remotecall_8c.html#ac47ac4dc756a23a8371747c4332d8fc0" title="Anzahl der Remote-Calls im Array.">STORED_CALLS</a> - 1));
<a name="l00618"></a>00618             }
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620 
<a name="l00621"></a>00621         ptr_call = &amp;<a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[row];
<a name="l00622"></a>00622         <a class="code" href="display_8h.html#ad5109335e4419b07f4d9f73db290f2eb">display_cursor</a>(i, 1);
<a name="l00623"></a>00623         <span class="keyword">const</span> <span class="keywordtype">char</span> tmp = (char) (i == (selected_row + 1) ? <span class="charliteral">&#39;&gt;&#39;</span> : <span class="charliteral">&#39; &#39;</span>);
<a name="l00624"></a>00624         <a class="code" href="display_8h.html#a3b34665813cc31ce81d141e4f67162d2">display_printf</a>(<span class="stringliteral">&quot;%c&quot;</span>, tmp);
<a name="l00625"></a>00625         <a class="code" href="display_8c.html#a5aa764a681bf5ad55de2f297cfb4f1d3">display_flash_puts</a>(ptr_call-&gt;name + (<span class="keyword">sizeof</span>(<span class="stringliteral">&quot;bot_&quot;</span>) - 1));
<a name="l00626"></a>00626     }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     <a class="code" href="display_8h.html#ad5109335e4419b07f4d9f73db290f2eb">display_cursor</a>(4, 1);
<a name="l00629"></a>00629     <span class="keywordflow">if</span> (running_behaviour == <a class="code" href="behaviour__remotecall_8c.html#adfbd6a5743f9a7497c87cd42e8ad3693">REMOTE_CALL_RUNNING</a>) {
<a name="l00630"></a>00630         <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot;Abbruch: Stopp&quot;</span>);
<a name="l00631"></a>00631         <a class="code" href="display_8h.html#ad5109335e4419b07f4d9f73db290f2eb">display_cursor</a>(3, 1);
<a name="l00632"></a>00632         <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot; gestartet.&quot;</span>);
<a name="l00633"></a>00633         <a class="code" href="display_8h.html#ad5109335e4419b07f4d9f73db290f2eb">display_cursor</a>(2, 1);
<a name="l00634"></a>00634         <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot; (&quot;</span>);
<a name="l00635"></a>00635         uint8_t <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00636"></a>00636         <span class="keywordflow">for</span> (i = 0; i &lt; parameter_count; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00637"></a>00637             <span class="keywordflow">if</span> (i != 0) {
<a name="l00638"></a>00638                 <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot;,&quot;</span>);
<a name="l00639"></a>00639             }
<a name="l00640"></a>00640 <span class="preprocessor">#ifdef MCU</span>
<a name="l00641"></a>00641 <span class="preprocessor"></span>            int16_t * ptr = (int16_t *) parameter_data;
<a name="l00642"></a>00642             int16_t tmp = ptr[(<span class="keyword">sizeof</span>(parameter_data) / <span class="keyword">sizeof</span>(int16_t) - 1) - i];
<a name="l00643"></a>00643             <span class="keywordflow">if</span> ((tmp &amp; 0x80) &amp;&amp; pgm_read_byte(&amp;ptr_call-&gt;param_len[i]) == 1) {
<a name="l00644"></a>00644                 <span class="comment">/* Vorzeichenerweiterung */</span>
<a name="l00645"></a>00645                 tmp = (int16_t) (tmp | (int16_t) 0xff00);
<a name="l00646"></a>00646             }
<a name="l00647"></a>00647 <span class="preprocessor">#else // PC</span>
<a name="l00648"></a>00648 <span class="preprocessor"></span>            <a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> * ptr = (<a class="code" href="unionremote__call__data__t.html" title="Union fuer Remotecall-Daten.">remote_call_data_t</a> * ) parameter_data;
<a name="l00649"></a>00649             <span class="keyword">const</span> int16_t tmp = ptr[<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>].<a class="code" href="unionremote__call__data__t.html#a148b79413df7654a5211bf5e583c0220" title="16 Bit signed integer">s16</a>;
<a name="l00650"></a>00650 <span class="preprocessor">#endif // MCU</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>            <a class="code" href="display_8h.html#a3b34665813cc31ce81d141e4f67162d2">display_printf</a>(<span class="stringliteral">&quot;%d&quot;</span>, tmp);
<a name="l00652"></a>00652         }
<a name="l00653"></a>00653         <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot;)&quot;</span>);
<a name="l00654"></a>00654         <span class="keywordflow">return</span>;
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keyword">const</span> uint8_t par_count = pgm_read_byte(&amp;ptr_call-&gt;param_count);
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (keypad_param_index &lt; par_count &amp;&amp; beh_selected &gt; 0) {
<a name="l00659"></a>00659         <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot;ok:Play | Korr:Stopp&quot;</span>);
<a name="l00660"></a>00660         <a class="code" href="display_8h.html#ad5109335e4419b07f4d9f73db290f2eb">display_cursor</a>(2, 1);
<a name="l00661"></a>00661         <span class="keyword">const</span> <span class="keywordtype">char</span> * p_info = ptr_call-&gt;param_info;
<a name="l00662"></a>00662         uint8_t <a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>;
<a name="l00663"></a>00663         <span class="keywordflow">for</span> (i = 0; i &lt; keypad_param_index; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00664"></a>00664             p_info = strchr_P(p_info, <span class="charliteral">&#39;,&#39;</span>);
<a name="l00665"></a>00665             p_info += 2; <span class="comment">// &quot;, &quot; weg</span>
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667         <a class="code" href="display_8c.html#a5aa764a681bf5ad55de2f297cfb4f1d3">display_flash_puts</a>(p_info);
<a name="l00668"></a>00668         <span class="keyword">const</span> <span class="keywordtype">char</span> * p_info_end = strchr_P(p_info, <span class="charliteral">&#39;,&#39;</span>);
<a name="l00669"></a>00669         <span class="keywordflow">if</span> (p_info_end != NULL) {
<a name="l00670"></a>00670             uint8_t len = (uint8_t) (p_info_end - p_info);
<a name="l00671"></a>00671             <a class="code" href="display_8h.html#ad5109335e4419b07f4d9f73db290f2eb">display_cursor</a>(2, len + 1);
<a name="l00672"></a>00672             <span class="keywordflow">for</span> (i = len; i &lt; <a class="code" href="display_8h.html#af6ee563305ef3cd17e7389e4d4c876c2">DISPLAY_LENGTH</a>; ++<a class="code" href="behaviour__drive__chess_8c.html#a9aa40e637eff435d9abc0f4dc467b6bb">i</a>) {
<a name="l00673"></a>00673                 <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot; &quot;</span>);
<a name="l00674"></a>00674             }
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676         <a class="code" href="display_8h.html#ad5109335e4419b07f4d9f73db290f2eb">display_cursor</a>(3, 1);
<a name="l00677"></a>00677         <a class="code" href="display_8h.html#a3b34665813cc31ce81d141e4f67162d2">display_printf</a>(<span class="stringliteral">&quot;par%1u/%1u: &quot;</span>, keypad_param_index + 1, par_count);
<a name="l00678"></a>00678         <span class="keywordflow">if</span> (beh_selected == 1) {
<a name="l00679"></a>00679             keypad_params[keypad_param_index].<a class="code" href="unionremote__call__data__t.html#a0366901b0aa01efdb0092c161f0560fe" title="32 Bit unsigned integer">u32</a> = 0;
<a name="l00680"></a>00680             beh_selected = 2;
<a name="l00681"></a>00681             <a class="code" href="gui_8c.html#add79d0b384af2eb1ae4bea86fb7eb468" title="Startet eine neue Keypad-Eingabe.">gui_keypad_request</a>(keypad_param, 1, 3, 9);
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (par_count - keypad_param_index == 0) {
<a name="l00684"></a>00684         <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot;Start: Play&quot;</span>);
<a name="l00685"></a>00685         <span class="keywordflow">if</span> (beh_selected == 1) {
<a name="l00686"></a>00686             beh_selected = 0;
<a name="l00687"></a>00687             keypad_param_index = 0;
<a name="l00688"></a>00688             <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;first_row=%u&quot;</span>, first_row);
<a name="l00689"></a>00689 <span class="preprocessor">#ifdef PC</span>
<a name="l00690"></a>00690 <span class="preprocessor"></span>            <a class="code" href="behaviour__remotecall_8c.html#a754b3d074e0af4ad3c7b918dd77ecb2d">LOG_DEBUG</a>(<span class="stringliteral">&quot;starte \&quot;%s\&quot;&quot;</span>, <a class="code" href="behaviour__remotecall_8h.html#a30a81f86ee968136e4620481d3656295" title="Liste aller Botenfunktionen von Verhalten, die remote aufgerufen werden koennen.">remotecall_beh_list</a>[first_row].name);
<a name="l00691"></a>00691 <span class="preprocessor">#endif</span>
<a name="l00692"></a>00692 <span class="preprocessor"></span>            bot_remotecall_from_id(NULL, first_row, keypad_params);
<a name="l00693"></a>00693         }
<a name="l00694"></a>00694     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (beh_selected == 0) {
<a name="l00695"></a>00695         <a class="code" href="display_8h.html#ac5ba4c9512c407150e76ef8b97910271">display_puts</a>(<span class="stringliteral">&quot;Auswaehlen: Play&quot;</span>);
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 <span class="preprocessor">#endif // DISPLAY_REMOTECALL_AVAILABLE</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span>
<a name="l00700"></a>00700 <span class="preprocessor">#endif // BEHAVIOUR_REMOTECALL_AVAILABLE</span>
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Erzeugt am Mit Feb 29 2012 14:18:08 f√ºr c't-Bot von &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
